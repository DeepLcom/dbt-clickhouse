---
version: '3'

x-ch-common: &ch-common
  image: clickhouse/clickhouse-server:${DBT_CH_TEST_CH_VERSION:-latest}
  volumes:
    - /var/lib/clickhouse
    - type: bind
      source: ${PROJECT_ROOT:-.}/test_settings_${DBT_CH_TEST_SETTINGS:-latest}.xml
      target: /etc/clickhouse-server/users.d/test_settings.xml
  ulimits:
    nofile:
      soft: 262144
      hard: 262144

services:
  clickhouse:
    <<: *ch-common
    volumes:
      - type: bind
        source: ${PROJECT_ROOT:-.}/test_config.xml
        target: /etc/clickhouse-server/config.d/test_config.xml

  clickhouse-remote:
    <<: *ch-common
    volumes:
      - type: bind
        source: ${PROJECT_ROOT:-.}/test_config_remote.xml
        target: /etc/clickhouse-server/config.d/test_config_remote.xml
